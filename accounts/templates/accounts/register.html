{%extends 'accounts/base.html' %}
{%block content%}
    <div class="container mt-5">
        <div class="shadow-lg p-5 mb-5 bg-body-tertiary rounded-5 pt-5" id="bg">
        <p class="text-center text-light fw-bold fs-3"><img src="https://cdn-icons-png.flaticon.com/128/2331/2331970.png" style="width: 40px;"> ShopLocal-Hub</p>
         <p class="fs-1 text-center pt-5"><span class=>Welcome!</span></p>
         <div id="msg"></div>
         <form id="registerForm">
        <div class="row">
            <div class="col-12 mb-3">
                <input type="text" name="name" id="name" class="form-control" placeholder="Full Name">
            </div>
              <div class="col-12 mb-3">
                <input type="number" name="phone_number" id="phone_number" class="form-control" placeholder="+91..  *">
              </div>
              <div class="col-12 mb-3">
                <input type="email" name="email" id="email" class="form-control" placeholder="name@.com..   *">
              </div>
              <div class="col-12 mb-3">
                <input type="text" name="username" id="username" class="form-control" placeholder="Username *">
              </div>
              <div class="col-12 mb-3">
                <input type="text" name="address" id="address" class="form-control" placeholder="Address">
              </div>
              <div class="col-12 mb-3">
                <label for="image">Image:</label>
                <input type="file" name="image" id="image" class="form-control" placeholder="image">
              </div>
              <div class="col-12 mb-3">
                <input type="password" name="password" id="password" class="form-control" placeholder="password *">
              </div>
              <div class="col-12 mb-3">
                <input type="password" name="password2" id="password2" class="form-control" placeholder="Confirm Password *">
              </div>
              <div class="col-12 mb-3">
                <button type="submit" class="btn btn-large text-light fw-bold rounded" style="background-image: url('https://wallpaperaccess.com/full/1732235.jpg');width:100%;">Sign UP</button>
              </div>
              <div class="col-12 text-center">
                <p>Existing user? <a href="{%url 'accounts:login_page'%}" style="color: rgb(80, 126, 178);" class="fw-bold" >Sign In</a></p>
              </div>
        </div>
         </form>
        </div>
    </div>
{%endblock%}


{%block scripts%}
<script>
 
  const form = document.getElementById('registerForm');
  const msg = document.getElementById('msg');



form.addEventListener('submit', async (e) => {
  e.preventDefault();
  msg.textContent = '';
  msg.className = '';

  const name = document.getElementById('name').value.trim();
  const phone_number=document.getElementById('phone_number').value.trim();
  const username   = document.getElementById('username').value.trim();
  const email      = document.getElementById('email').value.trim();
  const avatarElem = document.getElementById('image');
  const address        = document.getElementById('address').value.trim();
  const password   = document.getElementById('password').value;
   const password2  = document.getElementById('password2').value;

  if (!username || !email || !password) {
    msg.innerHTML ='<p class="alert alert-danger" role="alert">Username, email and password are required.</p>';
     return;
  }

  console.log('username |'+username+'|');
  console.log('email |'+email+'|');

  const formData = new FormData();
  formData.append('name', name);
  formData.append('phone_number', phone_number);
  formData.append('username', username);
  formData.append('email', email);
  formData.append('address',address);
  formData.append('password', password);
  formData.append('password2', password2);

  if (avatarElem.files.length > 0) {
    formData.append('image', avatarElem.files[0]);
  }

  try {
     const res = await fetch('/api/register/', {
      method: 'POST',
    
      body: formData
    });
    const data = await res.json();

  if (!res.ok) {
      console.error('Validation Errors:', data);
      // Display errors appropriately (fields etc.)
      msg.innerHTML=`<p class="alert alert-danger" role="alert">${JSON.stringify(data)}</p>`;
      return;
    }

    console.log('Registration succeeded:', data);
        msg.innerHTML= '<p class="alert alert-success" role="alert">Account Created successfully</p>';

  setTimeout(function() {
  window.location.href = "/login/";  
}, 3000);


  } catch (err) {
    console.error('Fetch error:', err);
    msg.innerHTML =`<p class="alert alert-danger" role="alert">An error occurred. Please try again.</p>`;
  }


    
  });
</script>
{%endblock scripts%}